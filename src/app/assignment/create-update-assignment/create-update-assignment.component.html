<ng-container *transloco="let t">
  <form [formGroup]="form" novalidate (ngSubmit)="submitAndCreate($event)">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{
          isUpdate ? t("ASSIGN_UPDATE_TITLE") : t("ASSIGN_CREATE_TITLE")
        }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="row">
          <mat-form-field>
            <mat-label>{{ t("ASSIGN_CHOOSE_DATE") }}</mat-label>
            <input
              required
              appautofocus
              matInput
              [matDatepicker]="picker"
              formControlName="date"
            />
            <mat-datepicker-toggle
              matPrefix
              [for]="picker"
              class="mr-3"
            ></mat-datepicker-toggle>
            <mat-datepicker
              id="assignmentDatepickerId"
              #picker
              [startAt]="this.lastDateService.lastDate$ | async"
              (closed)="warningIfAlreadyHasWork()"
            ></mat-datepicker>
          </mat-form-field>
          <div class="col-6 mb-2">
            <mat-form-field>
              <mat-label>{{ t("ASSIGN_ROOM") }}</mat-label>
              <mat-select
                formControlName="room"
                required
                (closed)="warningIfAlreadyHasWork()"
              >
                <mat-option
                  *ngFor="let room of rooms; trackBy: trackByIdRoomFn"
                  [value]="room.id"
                >
                  {{ room.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-6 mb-2">
            <mat-form-field>
              <mat-label>{{ t("ASSIGN_ASSIGNTYPE") }}</mat-label>
              <mat-select
                formControlName="assignType"
                required
                (closed)="warningIfAlreadyHasWork()"
              >
                <mat-option
                  *ngFor="
                    let assignType of assignTypes;
                    trackBy: trackByIdAssignTypeFn
                  "
                  [value]="assignType.id"
                  [style.borderLeft]="getBorderLeftStyle(assignType.color)"
                >
                  {{ assignType.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12 mb-2">
            <mat-form-field>
              <mat-label>{{ t("ASSIGN_THEME") }}</mat-label>
              <input matInput spellcheck="false" formControlName="theme" />
            </mat-form-field>
          </div>
          <div class="col-12 mb-2">
            <div class="d-flex align-items-baseline justify-content-start">
              <span class="d-inline-block me-3">
                <mat-icon
                  class="me-2"
                  svgIcon="woman"
                  aria-label="icon"
                ></mat-icon>
                <mat-checkbox
                  labelPosition="before"
                  color="primary"
                  formControlName="onlyWoman"
                  [disableRipple]="true"
                  >{{ t("ASSIGN_ONLY_WOMEN") }}</mat-checkbox
                >
              </span>
              <span class="d-inline-block me-3">
                <mat-icon
                  class="me-2"
                  svgIcon="man"
                  aria-label="icon"
                ></mat-icon>
                <mat-checkbox
                  labelPosition="before"
                  color="primary"
                  formControlName="onlyMan"
                  [disableRipple]="true"
                  >{{ t("ASSIGN_ONLY_MEN") }}</mat-checkbox
                >
              </span>
              <span>
                <mat-checkbox
                  labelPosition="before"
                  color="primary"
                  formControlName="onlyExternals"
                  [disableRipple]="true"
                  >{{ t("ASSIGN_ONLY_EXTERNALS") }}</mat-checkbox
                >
              </span>
            </div>
          </div>
          <div class="col-12 mb-2">
            <mat-form-field>
              <mat-label>{{ t("ASSIGN_PRINCIPAL") }}</mat-label>
              <mat-select
                #principalSelect
                formControlName="principal"
                required
                (selectionChange)="onSelectionChangePrincipal()"
                [disableRipple]="true"
              >
                <mat-select-trigger *ngIf="principalSelect.value">
                  {{ (principalSelect.value | participantPipe).name }}
                </mat-select-trigger>
                <mat-option
                  *ngFor="let participant of principals; trackBy: trackByIdFn"
                  [value]="participant.id"
                >
                  <div class="grid">
                    <div>
                      <mat-icon
                        *ngIf="participant.hasWork"
                        (click)="
                          onPrincipalIconWarningClick(
                            $event,
                            participant,
                            false
                          )
                        "
                        svgIcon="warning"
                        aria-label="icon"
                      ></mat-icon>
                      <mat-icon
                        *ngIf="!participant.hasWork"
                        (click)="
                          onPrincipalIconInfoClick($event, participant, false)
                        "
                        svgIcon="info-blue"
                        aria-label="icon"
                      ></mat-icon>
                    </div>
                    <div>{{ participant.count }}</div>
                    <div>{{ participant.name }}</div>
                  </div>
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12 mb-2">
            <mat-form-field>
              <mat-label>{{ t("ASSIGN_ASSISTANT") }}</mat-label>
              <mat-select
                #assistantSelect
                formControlName="assistant"
                (selectionChange)="onSelectionChangeAssistant()"
                [disableRipple]="true"
              >
                <mat-select-trigger *ngIf="assistantSelect.value">
                  {{ (assistantSelect.value | participantPipe).name }}
                </mat-select-trigger>
                <mat-option
                  *ngFor="let participant of assistants; trackBy: trackByIdFn"
                  [value]="participant.id"
                  [ngClass]="{
                    'bg-color-lightyellow': participant.hasWork,
                    'no-hover': true
                  }"
                >
                  {{ participant.count }} - {{ participant.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12 mb-2">
            <mat-form-field>
              <mat-label>{{ t("ASSIGN_FOOTER_NOTE") }}</mat-label>
              <mat-select formControlName="footerNote" [disableRipple]="true">
                <mat-option [value]="undefined"></mat-option>
                <mat-option *ngFor="let note of footerNotes" [value]="note.id">
                  {{ note.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button
          class="me-3"
          mat-raised-button
          [disableRipple]="true"
          type="button"
          [routerLink]="isUpdate ? '../..' : '..'"
        >
          {{ t("BUTTON_CANCEL") }}
        </button>
        <button
          class="me-3"
          mat-raised-button
          color="primary"
          type="button"
          (click)="onSubmit($event)"
          [disabled]="form.invalid"
        >
          {{ isUpdate ? t("BUTTON_UPDATE") : t("BUTTON_SAVE") }}
        </button>
        <button
          *ngIf="!isUpdate"
          #btnSaveCreateAnother
          mat-raised-button
          color="accent"
          type="submit"
          [disableRipple]="true"
          [disabled]="form.invalid"
        >
          {{ t("BUTTON_SAVE_CREATE_ANOTHER") }}
        </button>
      </mat-card-actions>
    </mat-card>
  </form>
</ng-container>
