<span *transloco="let t">
  <div class="d-flex align-items-center justify-content-start mb-2">
    <div
      class="col-auto me-3"
      [matTooltip]="t('TERRITORY_NO_TGROUPS_CREATED')"
      [matTooltipDisabled]="!!territoryGroups.length"
    >
      <a
        mat-raised-button
        color="primary"
        routerLink="create"
        routerLinkActive="active"
        [disabled]="!territoryGroups.length || (netStatusOffline$ | async)"
        >{{ t("TERRITORY_BUTTON_CREATE_TITLE") }}
        <mat-icon *ngIf="netStatusOffline$ | async" svgIcon="nowifi"></mat-icon
      ></a>
    </div>
    <div class="col-auto">
      <mat-icon
        *ngIf="territories.length"
        [routerLink]="['heatmap']"
        routerLinkActive="active"
        svgIcon="heatmap"
        [matTooltip]="t('ICON_HEATMAP')"
        aria-label="Side nav toggle icon"
      ></mat-icon>
    </div>
  </div>
</span>
<ng-container *ngFor="let tg of territoryGroups">
  <div class="mt-3 mb-2">
    <mat-accordion *transloco="let t">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h3 class="d-flex">
              <div
                class="me-3"
                [ngStyle]="{ width: '25px', height: '25px', 'background-color': tg.color }"
              ></div>
              <span>{{ tg.name }} - {{ getLengthForGroup(tg.id) }}</span>
            </h3>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <ng-template #noCreatedTerritoryTpl>
          <div>{{ t("TERRITORY_NO_TERRITORY_PLACEHOLDER") }}</div>
        </ng-template>
        <div *ngIf="territories.length; else noCreatedTerritoryTpl" class="grid">
          <div class="grid-header-item fw-bold">
            {{ t("TERRITORY_TABLE_HEADER_MAPLINK") }}
          </div>
          <div class="grid-header-item fw-bold">
            {{ t("TERRITORY_TABLE_HEADER_NAME") }}
          </div>
          <div class="grid-header-item fw-bold">
            {{ t("TERRITORY_TABLE_HEADER_ASSIGN_OR_EDIT") }}
          </div>
          <div class="grid-header-item fw-bold">
            {{ t("TERRITORY_TABLE_HEADER_RETURN") }}
          </div>
          <div class="grid-header-item fw-bold">
            {{ t("TERRITORY_TABLE_HEADER_DELETE") }}
          </div>
          <ng-container *ngFor="let terr of territories">
            <ng-container *ngIf="terr.groups.includes(tg.id)">
              <div class="grid-row">
                <div class="grid-item d-flex align-items-center">
                  <mat-icon
                    *ngIf="terr.poligonId"
                    class="me-3"
                    #iconMapLink
                    routerLinkActive="active"
                    svgIcon="maplink"
                    (click)="generateMapLink(terr, iconMapLink)"
                    aria-label="Side nav toggle icon"
                  ></mat-icon>
                  <mat-icon
                    routerLinkActive="active"
                    *ngIf="terr.poligonId || terr.imageId"
                    svgIcon="pdf"
                    (click)="toPdf(terr)"
                    aria-label="Side nav toggle icon"
                  ></mat-icon>
                </div>
                <div class="grid-item d-flex align-items-center">
                  {{ terr.name }} -
                  {{
                    terr.returnedDates.length !== terr.participants.length
                      ? (terr.participants?.at(-1) | participantPipe)?.name
                      : t("TERRITORY_NOT_ASSIGNED")
                  }}
                </div>
                <div class="grid-item d-flex align-items-center">
                  <mat-icon
                    [routerLink]="['update', terr.id]"
                    routerLinkActive="active"
                    svgIcon="edit"
                    aria-label="Side nav toggle icon"
                  ></mat-icon>
                </div>
                <div class="grid-item d-flex align-items-center">
                  <mat-icon
                    *ngIf="
                      terr.participants.length > terr.returnedDates.length;
                      else returnedTpl
                    "
                    [routerLink]="['return', terr.id]"
                    routerLinkActive="active"
                    svgIcon="return"
                    aria-label="Side nav toggle icon"
                  ></mat-icon>
                  <ng-template #returnedTpl>{{
                    terr.participants.length === 0 && terr.returnedDates.length === 0
                      ? t("TERRITORY_TABLE_NEVER_ASSIGNED")
                      : t("TERRITORY_TABLE_RETURNED")
                  }}</ng-template>
                </div>
                <div class="grid-item d-flex align-items-center">
                  <mat-icon
                    [routerLink]="['delete', terr.id]"
                    routerLinkActive="active"
                    svgIcon="garbage"
                    aria-label="Side nav toggle icon"
                  ></mat-icon>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</ng-container>
