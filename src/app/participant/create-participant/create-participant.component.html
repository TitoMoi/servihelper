<ng-container *ngIf="isRoomsAvailable && isAssignTypesAvailable">
  <form [formGroup]="participantForm" novalidate (ngSubmit)="submitAndCreate()">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{
          "PARTICIPANT_CREATE_TITLE" | transloco
        }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="row">
          <div class="col-12">
            <mat-form-field>
              <mat-label>{{ "PLACEHOLDER_NAME" | transloco }}</mat-label>
              <input
                matInput
                appautofocus
                spellcheck="false"
                formControlName="name"
              />
            </mat-form-field>
          </div>
          <div class="col-6">
            <mat-checkbox
              labelPosition="before"
              color="primary"
              formControlName="isWoman"
              >{{ "PARTICIPANT_CREATE_ISWOMAN" | transloco }}</mat-checkbox
            >
          </div>
          <div class="col-6">
            <mat-checkbox
              labelPosition="before"
              color="primary"
              formControlName="isExternal"
              >{{ "PARTICIPANT_CREATE_ISEXTERNAL" | transloco }}</mat-checkbox
            >
          </div>
          <div class="col-12 mr-auto">
            <h3 *ngIf="rooms.length">
              {{ "PARTICIPANT_CREATE_ROOMS_TITLE" | transloco }}
            </h3>
            <div class="row mb-2">
              <ng-container formArrayName="rooms">
                <ng-container
                  *ngFor="let r of getRoomsForm.controls; let i = index"
                >
                  <div class="col-12" [formGroupName]="i">
                    <mat-checkbox color="primary" formControlName="available">{{
                      getRoom(r.value.roomId).name
                    }}</mat-checkbox>
                  </div>
                </ng-container>
              </ng-container>
            </div>
          </div>

          <!-- principal assignTypes -->
          <div class="col-12">
            <h3 *ngIf="assignTypes.length">
              {{ "PARTICIPANT_CREATE_ASSIGNTYPE_PRINCIPAL" | transloco }}
            </h3>
            <div class="row mb-2">
              <ng-container formArrayName="assignTypes">
                <ng-container
                  *ngFor="let at of getAssignTypesForm.controls; let j = index"
                >
                  <div class="col-auto" [formGroupName]="j">
                    <mat-checkbox
                      color="primary"
                      formControlName="canPrincipal"
                      >{{
                        getAssignType(at.value.assignTypeId).name
                      }}</mat-checkbox
                    >
                  </div>
                </ng-container>
              </ng-container>
            </div>
          </div>

          <!-- assistant assignTypes -->
          <div class="col-12">
            <h3 *ngIf="assignTypes.length">
              {{ "PARTICIPANT_CREATE_ASSIGNTYPE_ASSISTANT" | transloco }}
            </h3>
            <div class="row mb-2">
              <ng-container formArrayName="assignTypes">
                <ng-container
                  *ngFor="let at of getAssignTypesForm.controls; let z = index"
                >
                  <div
                    *ngIf="getAssignType(at.value.assignTypeId).hasAssistant"
                    class="col-auto"
                    [formGroupName]="z"
                  >
                    <mat-checkbox
                      color="primary"
                      formControlName="canAssistant"
                      >{{
                        getAssignType(at.value.assignTypeId).name
                      }}</mat-checkbox
                    >
                  </div>
                </ng-container>
              </ng-container>
            </div>
          </div>

          <div class="col-12">
            <hr />
            <mat-checkbox
              labelPosition="before"
              color="primary"
              formControlName="available"
              >{{ "PARTICIPANT_CREATE_AVAILABLE" | transloco }}</mat-checkbox
            >
          </div>
          <div class="col-12">
            <mat-form-field>
              <mat-chip-grid
                #chipList
                aria-label="PARTICIPANT_CHOOSE_DATE_NOT_AVAILABLE"
                (click)="picker.open()"
              >
                <mat-chip-row
                  *ngFor="let date of notAvailableDates"
                  [selectable]="false"
                  [removable]="true"
                  (removed)="remove(date)"
                >
                  {{ date | translocoDate : { dateStyle: "short" } }}
                  <mat-icon matChipRemove svgIcon="garbage"></mat-icon>
                </mat-chip-row>
                <mat-label *ngIf="!notAvailableDates.length">{{
                  "PARTICIPANT_CHOOSE_DATE_NOT_AVAILABLE" | transloco
                }}</mat-label>
                <input
                  [value]="resetModel"
                  matInput
                  [matDatepicker]="picker"
                  (dateChange)="dateChanged($event)"
                  [matChipInputFor]="chipList"
                  hidden
                />
              </mat-chip-grid>
              <mat-datepicker-toggle
                matPrefix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker
                #picker
                [startAt]="init"
                [dateClass]="dateClass"
              ></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-raised-button type="button" class="me-3" routerLink="..">
          {{ "BUTTON_CANCEL" | transloco }}
        </button>
        <button
          mat-raised-button
          class="me-3"
          color="primary"
          type="button"
          (click)="onSubmit()"
          [disabled]="participantForm.invalid"
        >
          {{ "BUTTON_SAVE" | transloco }}
        </button>
        <button
          mat-raised-button
          color="accent"
          type="submit"
          [disabled]="participantForm.invalid"
        >
          {{ "BUTTON_SAVE_CREATE_ANOTHER" | transloco }}
        </button>
      </mat-card-actions>
    </mat-card>
  </form>
</ng-container>
