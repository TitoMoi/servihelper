<form *transloco="let t" novalidate [formGroup]="form" (ngSubmit)="submitAndCreate()">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{
        isUpdate ? t('PARTICIPANT_UPDATE_TITLE') : t('PARTICIPANT_CREATE_TITLE')
      }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="row">
        <div class="col-12">
          <mat-form-field>
            <mat-label>{{ t('PLACEHOLDER_NAME') }}</mat-label>
            <input
              formControlName="name"
              matInput
              spellcheck="false"
              [appautofocus]="isUpdate ? false : true" />
          </mat-form-field>
        </div>
        <div class="col-lg-4 col-6">
          <mat-form-field>
            <mat-label>{{ t('PLACEHOLDER_GROUP') }}</mat-label>
            <mat-select formControlName="group">
              @for (number of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; track number) {
                <mat-option [value]="number">{{ number }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-4">
          Current publisher registry:
          {{ (currentPublisherRegistryName$ | async) ?? t('PUBLISHER_REGISTRY_NOT_FOUND') }}
        </div>
        <div class="col-4">
          <span>{{ t('PLACEHOLDER_UPLOAD_PUBLISHER_REGISTRY') }}</span>
          <input
            id="zip-upload"
            type="file"
            [disabled]=""
            (change)="uploadPublisherRegistry($event)" />
        </div>
        <div class="row">
          <div class="col-auto">
            <mat-checkbox color="primary" formControlName="available" labelPosition="before">{{
              t('PARTICIPANT_CREATE_AVAILABLE')
            }}</mat-checkbox>
          </div>
          <div class="col-auto">
            <mat-checkbox color="primary" formControlName="isWoman" labelPosition="before">{{
              t('PARTICIPANT_CREATE_ISWOMAN')
            }}</mat-checkbox>
          </div>
          <div class="col-auto">
            <mat-checkbox color="primary" formControlName="isExternal" labelPosition="before">{{
              t('PARTICIPANT_CREATE_ISEXTERNAL')
            }}</mat-checkbox>
          </div>
        </div>
        <div class="participant-overflow">
          <div class="col-12 mr-auto">
            @if (rooms.length) {
              <h4>
                {{ t('PARTICIPANT_CREATE_ROOMS_TITLE') }}
              </h4>
            }
            <div class="row">
              <ng-container formArrayName="rooms">
                @for (r of getRoomsArray; track r.roomId; let i = $index) {
                  @if (r; as participantRoom) {
                    <div class="col-auto" [formGroupName]="i">
                      <mat-checkbox color="primary" formControlName="available">{{
                        participantRoom.roomId | roomPipe | roomNamePipe
                      }}</mat-checkbox>
                    </div>
                  }
                }
              </ng-container>
            </div>
          </div>
        </div>
        <div class="col-12">
          <mat-form-field>
            <mat-chip-grid
              #chipList
              aria-label="PARTICIPANT_CHOOSE_DATE_NOT_AVAILABLE"
              (click)="picker.open()">
              @for (date of getNotAvailableDates; track date) {
                <mat-chip-row removable="true" selectable="false" (removed)="remove(date)">
                  {{ date | translocoDate: { dateStyle: 'short' } }}
                  <mat-icon matChipRemove svgIcon="garbage" />
                </mat-chip-row>
              }
              @if (!getNotAvailableDates.length) {
                <mat-label>{{ t('PARTICIPANT_CHOOSE_DATE_NOT_AVAILABLE') }}</mat-label>
              }
              <input
                hidden
                matInput
                [matChipInputFor]="chipList"
                [matDatepicker]="picker"
                [value]="resetModel"
                (dateChange)="dateChanged($event)" />
            </mat-chip-grid>
            <mat-datepicker-toggle matPrefix [for]="picker" />
            <mat-datepicker #picker [dateClass]="dateClass" [startAt]="init" />
          </mat-form-field>
        </div>
      </div>
    </mat-card-content>
    <mat-card-actions>
      <button class="me-3" mat-raised-button type="button" [routerLink]="isUpdate ? '../..' : '..'">
        {{ t('BUTTON_CANCEL') }}
      </button>
      <button
        class="me-3"
        color="primary"
        mat-raised-button
        type="button"
        [disabled]="form.invalid"
        (click)="onSubmit()">
        {{ isUpdate ? t('BUTTON_UPDATE') : t('BUTTON_SAVE') }}
        @if (netStatusOffline$ | async) {
          <mat-icon svgIcon="nowifi" />
        }
      </button>
      @if (!isUpdate) {
        <button color="accent" mat-raised-button type="submit" [disabled]="form.invalid">
          {{ t('BUTTON_SAVE_CREATE_ANOTHER') }}
          @if (netStatusOffline$ | async) {
            <mat-icon svgIcon="nowifi" />
          }
        </button>
      }
    </mat-card-actions>
  </mat-card>
</form>
